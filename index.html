<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Tuition One-Off Fee (Minimal)</title>
  <script src="https://cdn.jotfor.ms/widgets/main.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 10px; }
    label { font-weight: bold; margin-top: 10px; display: block; }
    input, select, button {
      width: 100%; padding: 8px; margin: 5px 0 10px 0;
      border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box;
    }
    button { background: #2c3e50; color: #fff; border: 0; cursor: pointer; }
    .results { margin-top: 12px; padding: 10px; background: #f5f7f9; border: 1px solid #e3e7eb; border-radius: 6px; }
  </style>
</head>
<body>
  <h3>Tuition One-Off Fee</h3>

  <label for="startDate">Start Date</label>
  <input type="date" id="startDate" required>

  <label for="monthlyFee">Monthly Fee (£)</label>
  <input type="number" id="monthlyFee" min="0" step="0.01" value="100" required>

  <label for="saturdayHours">Saturday Hours</label>
  <input type="number" id="saturdayHours" min="0" step="0.1" value="2" required>

  <label for="sundayHours">Sunday Hours</label>
  <input type="number" id="sundayHours" min="0" step="0.1" value="1" required>

  <label for="wednesdayHours">Wednesday Hours</label>
  <input type="number" id="wednesdayHours" min="0" step="0.1" value="1.5" required>

  <label for="days">Select Tuition Days</label>
  <select id="days" required>
    <option value="6">Saturday Only</option>
    <option value="0">Sunday Only</option>
    <option value="3">Wednesday Only</option>
    <option value="weekend">Saturday and Sunday</option>
    <option value="all">Saturday, Sunday and Wednesday</option>
  </select>

  <button id="calcBtn">Calculate</button>

  <div class="results" id="results" style="display:none;">
    <p><strong>Tuition One-Off:</strong> £<span id="tuitionOneOff"></span></p>
    <p><strong>Weeks Charged:</strong> <span id="weeksCharged"></span></p>
  </div>

  <script>
    function calcTuitionOneOff() {
      // Inputs
      const startDateVal = document.getElementById('startDate').value;
      const monthlyFee = parseFloat(document.getElementById('monthlyFee').value || 0);
      const saturdayHours = parseFloat(document.getElementById('saturdayHours').value || 0);
      const sundayHours = parseFloat(document.getElementById('sundayHours').value || 0);
      const wednesdayHours = parseFloat(document.getElementById('wednesdayHours').value || 0);
      const selectedDay = document.getElementById('days').value;

      if (!startDateVal || !isFinite(monthlyFee)) return;

      const startDate = new Date(startDateVal);

      // Total weekly hours based on selection
      let totalWeeklyHours = 0;
      if (selectedDay === '6') totalWeeklyHours = saturdayHours;
      else if (selectedDay === '0') totalWeeklyHours = sundayHours;
      else if (selectedDay === '3') totalWeeklyHours = wednesdayHours;
      else if (selectedDay === 'weekend') totalWeeklyHours = saturdayHours + sundayHours;
      else if (selectedDay === 'all') totalWeeklyHours = saturdayHours + sundayHours + wednesdayHours;

      // Guard against divide-by-zero
      if (totalWeeklyHours <= 0) {
        alert('Total weekly hours is 0. Please check your hours and day selection.');
        return;
      }

      // Hourly rate: monthly fee divided by 4 weeks then by total weekly hours
      const hourlyRate = monthlyFee / (totalWeeklyHours * 4);

      // Date range: from start date to end of that month
      const year = startDate.getFullYear();
      const month = startDate.getMonth();
      const day = startDate.getDate();
      const daysInMonth = new Date(year, month + 1, 0).getDate();

      let tuitionOneOff = 0;
      const weeksCharged = new Set();

      for (let d = day; d <= daysInMonth; d++) {
        const current = new Date(year, month, d);
        const weekKey = current.getFullYear() + '-' + current.getMonth() + '-' + Math.floor((current.getDate() - 1) / 7); // coarse week id

        if (selectedDay === '6' && current.getDay() === 6) {
          tuitionOneOff += saturdayHours * hourlyRate;
          weeksCharged.add(weekKey);
        } else if (selectedDay === '0' && current.getDay() === 0) {
          tuitionOneOff += sundayHours * hourlyRate;
          weeksCharged.add(weekKey);
        } else if (selectedDay === '3' && current.getDay() === 3) {
          tuitionOneOff += wednesdayHours * hourlyRate;
          weeksCharged.add(weekKey);
        } else if (selectedDay === 'weekend') {
          if (current.getDay() === 6) { tuitionOneOff += saturdayHours * hourlyRate; weeksCharged.add(weekKey); }
          if (current.getDay() === 0) { tuitionOneOff += sundayHours * hourlyRate; weeksCharged.add(weekKey); }
        } else if (selectedDay === 'all') {
          if (current.getDay() === 6) { tuitionOneOff += saturdayHours * hourlyRate; weeksCharged.add(weekKey); }
          if (current.getDay() === 0) { tuitionOneOff += sundayHours * hourlyRate; weeksCharged.add(weekKey); }
          if (current.getDay() === 3) { tuitionOneOff += wednesdayHours * hourlyRate; weeksCharged.add(weekKey); }
        }
      }

      // Show results
      document.getElementById('tuitionOneOff').textContent = tuitionOneOff.toFixed(2);
      document.getElementById('weeksCharged').textContent = weeksCharged.size;
      document.getElementById('results').style.display = 'block';

      // Send to Jotform
      if (typeof JFCustomWidget !== 'undefined') {
        JFCustomWidget.sendData({
          tuitionOneOff: tuitionOneOff.toFixed(2),
          weeksCharged: weeksCharged.size
        });
      }
    }

    document.getElementById('calcBtn').addEventListener('click', calcTuitionOneOff);
  </script>
</body>
</html>
